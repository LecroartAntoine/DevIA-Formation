from PyQt5 import QtCore, QtGui, QtWidgets
import sys, os, Bar


class Ui_MainWindow(object):
    def setupUi(self, MainWindow):

        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Expanding, QtWidgets.QSizePolicy.Expanding)
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(620, 634)
        MainWindow.setWindowFlags(QtCore.Qt.CustomizeWindowHint | QtCore.Qt.FramelessWindowHint)

        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.main_layout = QtWidgets.QVBoxLayout(self.centralwidget)
        self.main_layout.setObjectName("main_layout")

        self.main_layout.addWidget(Bar.MyBar(MainWindow))
        self.main_layout.setContentsMargins(0,0,0,0)

########################### Écran ###########################

        self.lineEdit = QtWidgets.QLineEdit(self.centralwidget)
        self.lineEdit.setSizePolicy(sizePolicy)
        self.lineEdit.setMinimumSize(QtCore.QSize(0, 100))
        self.lineEdit.setObjectName("lineEdit")
        self.lineEdit.setReadOnly(True)
        self.lineEdit.setStyleSheet("font-weight: bold; font-family : Trebuchet MS; font-size : 40px;")
        self.lineEdit.setAlignment(QtCore.Qt.AlignRight)
        self.main_layout.addWidget(self.lineEdit)

###############################################################
########################### Boutons ###########################
###############################################################      
        self.button_layout = QtWidgets.QGridLayout()
        self.button_layout.setObjectName("button_layout")

########################### Nombres ###########################

        self.zero_button = QtWidgets.QPushButton(self.centralwidget)
        self.zero_button.setObjectName("zero_button")
        self.zero_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.zero_button, 4, 1, 1, 1)

        self.one_button = QtWidgets.QPushButton(self.centralwidget)
        self.one_button.setObjectName("one_button")
        self.one_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.one_button, 3, 0, 1, 1)  

        self.two_button = QtWidgets.QPushButton(self.centralwidget)
        self.two_button.setObjectName("two_button")
        self.two_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.two_button, 3, 1, 1, 1)    
        
        self.three_button = QtWidgets.QPushButton(self.centralwidget)
        self.three_button.setObjectName("three_button")
        self.three_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.three_button, 3, 2, 1, 1)

        self.four_button = QtWidgets.QPushButton(self.centralwidget)
        self.four_button.setObjectName("four_button")
        self.four_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.four_button, 2, 0, 1, 1)

        self.five_button = QtWidgets.QPushButton(self.centralwidget)
        self.five_button.setObjectName("five_button")
        self.five_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.five_button, 2, 1, 1, 1)

        self.six_button = QtWidgets.QPushButton(self.centralwidget)
        self.six_button.setObjectName("six_button")
        self.six_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.six_button, 2, 2, 1, 1)

        self.seven_button = QtWidgets.QPushButton(self.centralwidget)
        self.seven_button.setObjectName("seven_button")
        self.seven_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.seven_button, 1, 0, 1, 1)

        self.eight_button = QtWidgets.QPushButton(self.centralwidget)
        self.eight_button.setObjectName("eight_button")
        self.eight_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.eight_button, 1, 1, 1, 1)

        self.nine_button = QtWidgets.QPushButton(self.centralwidget)
        self.nine_button.setObjectName("nine_button")
        self.nine_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.nine_button, 1, 2, 1, 1)

########################### Opérateurs ###########################

        self.equal_button = QtWidgets.QPushButton(self.centralwidget)
        self.equal_button.setObjectName("equal_button")
        self.equal_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.equal_button, 4, 3, 1, 1)

        self.plus_button = QtWidgets.QPushButton(self.centralwidget)
        self.plus_button.setObjectName("plus_button")
        self.plus_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.plus_button, 3, 3, 1, 1)

        self.minus_button = QtWidgets.QPushButton(self.centralwidget)
        self.minus_button.setObjectName("minus_button")
        self.minus_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.minus_button, 2, 3, 1, 1)

        self.times_button = QtWidgets.QPushButton(self.centralwidget)
        self.times_button.setObjectName("times_button")
        self.times_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.times_button, 1, 3, 1, 1)

        self.div_button = QtWidgets.QPushButton(self.centralwidget)
        self.div_button.setObjectName("div_button")
        self.div_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.div_button, 0, 1, 1, 1)

        self.mod_button = QtWidgets.QPushButton(self.centralwidget)
        self.mod_button.setObjectName("mod_button")
        self.mod_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.mod_button, 0, 0, 1, 1)

########################### utils ###########################

        self.coma_button = QtWidgets.QPushButton(self.centralwidget)
        self.coma_button.setObjectName("coma_button")
        self.coma_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.coma_button, 4, 2, 1, 1)

        self.del_button = QtWidgets.QPushButton(self.centralwidget)
        self.del_button.setObjectName("del_button")
        self.del_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.del_button, 0, 3, 1, 1)

        self.neg_button = QtWidgets.QPushButton(self.centralwidget)
        self.neg_button.setObjectName("neg_button")
        self.neg_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.neg_button, 4, 0, 1, 1)

        self.clear_button = QtWidgets.QPushButton(self.centralwidget)
        self.clear_button.setObjectName("clear_button")
        self.clear_button.setSizePolicy(sizePolicy)
        self.button_layout.addWidget(self.clear_button, 0, 2, 1, 1)

        self.main_layout.addLayout(self.button_layout)
        MainWindow.setCentralWidget(self.centralwidget)

        self.isresult = False

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

########################### Connexions ###########################  

        self.zero_button.clicked.connect(self.zero)
        self.one_button.clicked.connect(self.one)
        self.two_button.clicked.connect(self.two)
        self.three_button.clicked.connect(self.three)
        self.four_button.clicked.connect(self.four)
        self.five_button.clicked.connect(self.five)
        self.six_button.clicked.connect(self.six)
        self.seven_button.clicked.connect(self.seven)
        self.eight_button.clicked.connect(self.eight)
        self.nine_button.clicked.connect(self.nine)
        self.plus_button.clicked.connect(self.plus)
        self.minus_button.clicked.connect(self.minus)
        self.times_button.clicked.connect(self.times)
        self.equal_button.clicked.connect(self.equal)
        self.del_button.clicked.connect(self.delete)
        self.mod_button.clicked.connect(self.mod)
        self.clear_button.clicked.connect(self.clear)
        self.div_button.clicked.connect(self.div)
        self.coma_button.clicked.connect(self.coma)
        self.neg_button.clicked.connect(self.neg)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.three_button.setText(_translate("MainWindow", "3"))
        self.five_button.setText(_translate("MainWindow", "5"))
        self.two_button.setText(_translate("MainWindow", "2"))
        self.one_button.setText(_translate("MainWindow", "1"))
        self.equal_button.setText(_translate("MainWindow", "="))
        self.mod_button.setText(_translate("MainWindow", "%"))
        self.coma_button.setText(_translate("MainWindow", "."))
        self.six_button.setText(_translate("MainWindow", "6"))
        self.four_button.setText(_translate("MainWindow", "4"))
        self.minus_button.setText(_translate("MainWindow", "-"))
        self.del_button.setText(_translate("MainWindow", "⌫"))
        self.nine_button.setText(_translate("MainWindow", "9"))
        self.neg_button.setText(_translate("MainWindow", "±"))
        self.plus_button.setText(_translate("MainWindow", "+"))
        self.seven_button.setText(_translate("MainWindow", "7"))
        self.clear_button.setText(_translate("MainWindow", "C"))
        self.times_button.setText(_translate("MainWindow", "x"))
        self.zero_button.setText(_translate("MainWindow", "0"))
        self.eight_button.setText(_translate("MainWindow", "8"))
        self.div_button.setText(_translate("MainWindow", "÷"))

    def zero(self):
        self.check_is_number()
        self.lineEdit.insert("0")
    
    def one(self):
        self.check_is_number()
        self.lineEdit.insert("1")
    
    def two(self):
        self.check_is_number()
        self.lineEdit.insert("2")
    
    def three(self):
        self.check_is_number()
        self.lineEdit.insert("3")

    def four(self):
        self.check_is_number()
        self.lineEdit.insert("4")

    def five(self):
        self.check_is_number()
        self.lineEdit.insert("5")

    def six(self):
        self.check_is_number()
        self.lineEdit.insert("6")

    def seven(self):
        self.check_is_number()
        self.lineEdit.insert("7")

    def eight(self):
        self.check_is_number()
        self.lineEdit.insert("8")

    def nine(self):
        self.check_is_number()
        self.lineEdit.insert("9")

    def plus(self):
        self.lineEdit.insert("+")

    def minus(self):
        self.lineEdit.insert("-")

    def times(self):
        self.lineEdit.insert("x")

    def delete(self):
        if self.lineEdit.text() == 'error':
            self.lineEdit.setText("")
        elif self.lineEdit.text():
            self.lineEdit.setText(self.lineEdit.text()[:-1])
    
    def equal(self):
        if self.lineEdit.text():
            try:
                self.lineEdit.setText(str(eval(self.lineEdit.text().replace("x", '*').replace("÷", '/'))))
            except:
                self.lineEdit.setText('error')

            self.isresult = True
    
    def mod(self):
        self.lineEdit.insert("%")
    
    def clear(self):
        self.lineEdit.clear()
    
    def div(self):
        self.lineEdit.insert("÷")

    def coma(self):
        self.lineEdit.insert(".")
    
    def neg(self):
        if self.lineEdit.text().replace("-", "").replace(".", "").isnumeric():
            self.lineEdit.setText(str(eval(self.lineEdit.text()) * - 1))
        elif self.lineEdit.text()[:2] == '-(':
            self.lineEdit.setText(self.lineEdit.text()[2:-1])
        else:
            self.lineEdit.setText("-(" + self.lineEdit.text() + ")")

    def check_is_number(self):
        if self.lineEdit.text() and ((self.lineEdit.text()[0] == "-" and self.lineEdit.text().replace('.', '')[1:].isnumeric()) or self.lineEdit.text().replace('.', '').isnumeric() and self.isresult) or self.lineEdit.text() == 'error':
            self.lineEdit.clear()
            self.isresult = False

if __name__ == "__main__":
    app = QtWidgets.QApplication(sys.argv)

    QtCore.QDir.addSearchPath('Assets', os.path.join(os.path.dirname(os.path.abspath(__file__)), 'Assets'))

    app.setWindowIcon(QtGui.QIcon("Assets:Logo.png"))
    file = QtCore.QFile('Assets:Style.qss')
    file.open(QtCore.QFile.ReadOnly | QtCore.QFile.Text)
    app.setStyleSheet(str(file.readAll(), 'utf-8'))


    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
