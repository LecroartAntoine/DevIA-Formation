from pushbullet import Pushbullet
import requests

API_KEY = 'o.7L5JqHeZoZ6DABerlZR4VgU48KfNlk5A'

def obtenir_metrique(nom_metrique):

    session = requests.Session()

    session.post('http://localhost:5000/dashboard/login', data = {'name' : 'admin', 'password' : 'admin'})

    url = f'http://localhost:5000/dashboard/api/{nom_metrique}'

    response = session.get(url, params = {'name' : 'admin', 'password' : 'admin'})

    if response.status_code == 200:
        data = response.json()['total_hits']
        return data
    else:
        return 'Erreur'

def envoyer_notification(titre, message):
    pb = Pushbullet(API_KEY)

    pb.push_note(titre, message)
    print("Notification envoyée avec succès!")

envoyer_notification("Get_allRapports", f"Nombre de fois que cette route à été utilisée : {obtenir_metrique('endpoint_info/2')}")