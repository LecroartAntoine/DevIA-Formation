import http.client, urllib, requests

def obtenir_metrique(nom_metrique):

    session = requests.Session()

    session.post('http://localhost:5000/dashboard/login', data = {'name' : 'admin', 'password' : 'admin'})

    url = f'http://localhost:5000/dashboard/api/{nom_metrique}'

    response = session.get(url, params = {'name' : 'admin', 'password' : 'admin'})

    if response.status_code == 200:
        data = response.json()['total_hits']
        return data
    else:
        print("Erreur lors de la récupération de la métrique:", response.text)



conn = http.client.HTTPSConnection("api.pushover.net:443")
conn.request("POST", "/1/messages.json",
  urllib.parse.urlencode({
    "token": "aiiw571ac7qrr3osxmg69cy6gda7u1",
    "user": "uyzxgc82afz5i4b53it7btcvu1b522",
    "message": f"Nombre de fois que /allRapports à été utilisée : {obtenir_metrique('endpoint_info/2')}",
  }), { "Content-type": "application/x-www-form-urlencoded" })