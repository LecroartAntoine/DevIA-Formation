import pytest
import requests

URL = "http://127.0.0.1:5000"

def get_token():
    login = {"username": "Grogu", "password": "Grogu"}

    response = requests.post("http://127.0.0.1:5000/login", json=login)
    if response.status_code == 200:
        token = response.json()["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
        return headers

def test_rapports_route():
    headers = get_token()

    if headers:
        response = requests.get(f"{URL}/allRapports", headers=headers)
        assert response.status_code == 200
        assert "application/json" in response.headers["Content-Type"]
    else:
        assert "Login failed"

def test_infos_route():
    headers = get_token()

    if headers:
        response = requests.get(f"{URL}/infos", headers=headers)
        assert response.status_code == 200
        assert "application/json" in response.headers["Content-Type"]
    else:
        assert "Login failed"


def test_parameters_route():
    headers = get_token()

    if headers:
        response = requests.get(f"{URL}/parametres", headers=headers)
        assert response.status_code == 200
        assert "application/json" in response.headers["Content-Type"]
    else:
        assert "Login failed"

if __name__ == "__main__":
    pytest.main()